@page "/settings"
@using Microsoft.AspNetCore.Components.Forms;
@using Microsoft.AspNetCore.Components.Web

<PageTitle>Settings</PageTitle>
<div class="row mb-3 mt-3">
    @if (errors.Count > 0)
    {
        <h2>Errors</h2>
        <ul class="text-danger">
            @foreach (var error in errors)
            {
                <li>@error</li>
            }
        </ul>
    }
    else
    {
        <div class="container mt-3">
            <div>
                <label>Upload Geckodriver executable here</label>
                <br />
                <button class="btn btn-primary" @onclick="LoadGeckodriver">Select Gecko Driver</button>
                <label>@GeckodriverFilePath</label>
            </div>
            <div>
                <label>Upload Firefox Profile folder here</label>
                <br />
                <button class="btn btn-primary" @onclick="LoadFirefoxProfile">Select Firefox Profile</button>
                <label>@FirefoxProfilePath</label>
            </div>
        </div>
        <div class="container mt-3">
            <div>
                @Message
            </div>
        </div>
    }
</div>

@code {
    private string? GeckodriverFilePath;
    private string? FirefoxProfilePath;
    private long maxFileSize = 1024 * 1024 * 5;
    private int maxAllowedFiles = 1;
    private string Message = "";
    private List<string> errors = new();

    private void LoadGeckodriver()
    {
        errors.Clear();
        OpenFileDialog openFileDialog = new OpenFileDialog();
        openFileDialog.Filter = "(*.exe) | *.exe";
        openFileDialog.Multiselect = false;
        DialogResult res = openFileDialog.ShowDialog();
        if (res == DialogResult.OK)
        {
            GeckodriverFilePath = openFileDialog.FileName; 
        }
    }
    private void LoadFirefoxProfile()
    {
        errors.Clear();
        FolderBrowserDialog folderBrowserDialog = new FolderBrowserDialog();
        folderBrowserDialog.InitialDirectory = Environment.GetFolderPath(Environment.SpecialFolder.LocalApplicationData);
        DialogResult res = folderBrowserDialog.ShowDialog();
        if (res == DialogResult.OK)
        {
            FirefoxProfilePath = folderBrowserDialog.SelectedPath;
        }
    }
}
